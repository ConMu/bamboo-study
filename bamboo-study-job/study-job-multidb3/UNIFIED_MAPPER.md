# ç»Ÿä¸€Mapperç»“æ„å®Œæˆ

## âœ… **é‡æ„å®Œæˆæ€»ç»“**

å·²æˆåŠŸå°†å¤šæ•°æ®æºé¡¹ç›®çš„mapperç»“æ„ç»Ÿä¸€åŒ–ï¼Œç°åœ¨å¯ä»¥é€šè¿‡AOPåˆ‡é¢åŠ¨æ€é€‰æ‹©æ•°æ®æºï¼Œè€Œæ— éœ€åœ¨mapperå±‚åŒºåˆ†db1/db2ã€‚

## ğŸ”§ **é‡æ„å†…å®¹**

### 1. **ç»Ÿä¸€Mapperæ¥å£**
```
åŸæ¥çš„ç»“æ„ï¼š
â”œâ”€â”€ mapper/
â”‚   â”œâ”€â”€ db1/
â”‚   â”‚   â””â”€â”€ UserMapper.java
â”‚   â””â”€â”€ db2/
â”‚       â””â”€â”€ PeopleMapper.java

é‡æ„åçš„ç»“æ„ï¼š
â”œâ”€â”€ mapper/
â”‚   â”œâ”€â”€ UserMapper.java      âœ… ç»Ÿä¸€æ¥å£
â”‚   â””â”€â”€ PeopleMapper.java    âœ… ç»Ÿä¸€æ¥å£
```

### 2. **ç»Ÿä¸€XMLé…ç½®**
```
åŸæ¥çš„ç»“æ„ï¼š
â”œâ”€â”€ resources/.../mapper/
â”‚   â”œâ”€â”€ db1/
â”‚   â”‚   â””â”€â”€ UserMapper.xml
â”‚   â””â”€â”€ db2/
â”‚       â””â”€â”€ PeopleMapper.xml

é‡æ„åçš„ç»“æ„ï¼š
â”œâ”€â”€ resources/.../mapper/
â”‚   â”œâ”€â”€ UserMapper.xml       âœ… ç»Ÿä¸€é…ç½®
â”‚   â””â”€â”€ PeopleMapper.xml     âœ… ç»Ÿä¸€é…ç½®
```

### 3. **æ›´æ–°çš„namespace**
```xml
<!-- ä¹‹å‰ -->
<mapper namespace="com.conmu.sms.dao.mapper.db1.UserMapper">
<mapper namespace="com.conmu.sms.dao.mapper.db2.PeopleMapper">

<!-- ç°åœ¨ -->
<mapper namespace="com.conmu.sms.dao.mapper.UserMapper">     âœ…
<mapper namespace="com.conmu.sms.dao.mapper.PeopleMapper">   âœ…
```

### 4. **Serviceå±‚å¼•ç”¨æ›´æ–°**
```java
// ä¹‹å‰
import com.conmu.sms.dao.mapper.db1.UserMapper;
import com.conmu.sms.dao.mapper.db2.PeopleMapper;

// ç°åœ¨
import com.conmu.sms.dao.mapper.UserMapper;    âœ…
import com.conmu.sms.dao.mapper.PeopleMapper;  âœ…
```

## ğŸ¯ **æ¶æ„ä¼˜åŠ¿**

### âœ… **çœŸæ­£çš„åŠ¨æ€æ•°æ®æº**
- **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰mapperéƒ½åœ¨åŒä¸€ä¸ªåŒ…ä¸‹
- **åŠ¨æ€åˆ‡æ¢**: å®Œå…¨é€šè¿‡AOPåˆ‡é¢æ§åˆ¶æ•°æ®æº
- **çµæ´»æ€§**: å¯ä»¥å¯¹ä»»æ„è¡¨ä½¿ç”¨ä»»æ„æ•°æ®æº

### âœ… **ç®€åŒ–çš„é¡¹ç›®ç»“æ„**
```java
// ç°åœ¨å¯ä»¥è¿™æ ·çµæ´»ä½¿ç”¨
// ç”¨æˆ·è¡¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ•°æ®æº
curl -H "dsNo: ds0" /api/user/admin  âœ… æ•°æ®æº1
curl -H "dsNo: ds1" /api/user/admin  âœ… æ•°æ®æº2

// äººå‘˜è¡¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ•°æ®æº  
curl -H "dsNo: ds0" /api/people/å¼ ä¸‰  âœ… æ•°æ®æº1
curl -H "dsNo: ds1" /api/people/å¼ ä¸‰  âœ… æ•°æ®æº2
```

## ğŸš€ **ä½¿ç”¨åœºæ™¯**

### æ•°æ®åº“ç»“æ„ç›¸åŒçš„åœºæ™¯
ç”±äºæ‚¨çš„ä¸¤ä¸ªæ•°æ®åº“éƒ½æœ‰ç›¸åŒçš„è¡¨ç»“æ„ï¼Œç°åœ¨å¯ä»¥ï¼š

1. **è´Ÿè½½å‡è¡¡**: å°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒæ•°æ®åº“
2. **æ•°æ®å¤‡ä»½**: ä¸»å¤‡æ•°æ®åº“ä¹‹é—´åˆ‡æ¢
3. **ç¯å¢ƒåˆ‡æ¢**: å¼€å‘/æµ‹è¯•ç¯å¢ƒåŠ¨æ€åˆ‡æ¢
4. **ä¸šåŠ¡éš”ç¦»**: ä¸åŒä¸šåŠ¡çº¿ä½¿ç”¨ä¸åŒæ•°æ®æº

### æµ‹è¯•ç”¨ä¾‹
```bash
# åœ¨æ•°æ®æº1åˆ›å»ºç”¨æˆ·
curl -X POST -H "dsNo: ds0" -H "Content-Type: application/json" \
  http://localhost:8891/api/user \
  -d '{"username": "user_ds0", "password": "123456"}'

# åœ¨æ•°æ®æº2åˆ›å»ºç›¸åŒç”¨æˆ·  
curl -X POST -H "dsNo: ds1" -H "Content-Type: application/json" \
  http://localhost:8891/api/user \
  -d '{"username": "user_ds1", "password": "123456"}'

# éªŒè¯æ•°æ®æºéš”ç¦»
curl -H "dsNo: ds0" http://localhost:8891/api/user/user_ds0  # âœ… æ‰¾åˆ°
curl -H "dsNo: ds1" http://localhost:8891/api/user/user_ds0  # âŒ æ‰¾ä¸åˆ°

curl -H "dsNo: ds0" http://localhost:8891/api/user/user_ds1  # âŒ æ‰¾ä¸åˆ°  
curl -H "dsNo: ds1" http://localhost:8891/api/user/user_ds1  # âœ… æ‰¾åˆ°
```

## ğŸ“‹ **æ•°æ®æºæ˜ å°„è¡¨** (æ›´æ–°)

| dsNo | æ•°æ®åº“ | ç«¯å£ | æ”¯æŒçš„è¡¨ | è¯´æ˜ |
|------|--------|------|----------|------|
| `ds0` | yunxin_recovery | 3306 | users, people | æ•°æ®æº1 |
| `ds1` | test | 4407 | users, people | æ•°æ®æº2 |

## âš ï¸ **æ³¨æ„äº‹é¡¹**

1. **è¡¨ç»“æ„ä¸€è‡´æ€§**: ç¡®ä¿ä¸¤ä¸ªæ•°æ®åº“çš„è¡¨ç»“æ„å®Œå…¨ç›¸åŒ
2. **æ•°æ®ç‹¬ç«‹æ€§**: ä¸¤ä¸ªæ•°æ®æºçš„æ•°æ®æ˜¯ç‹¬ç«‹çš„
3. **äº‹åŠ¡è¾¹ç•Œ**: å•ä¸ªè¯·æ±‚å†…ä¸è¦åˆ‡æ¢æ•°æ®æº
4. **ç´¢å¼•ä¼˜åŒ–**: ä¸¤ä¸ªæ•°æ®åº“éƒ½è¦æœ‰é€‚å½“çš„ç´¢å¼•

## ğŸŠ **å®ŒæˆçŠ¶æ€**

- âœ… **Mapperç»Ÿä¸€**: æ‰€æœ‰æ¥å£ç»Ÿä¸€åœ¨ä¸€ä¸ªåŒ…ä¸‹
- âœ… **é…ç½®ç»Ÿä¸€**: XMLé…ç½®ç»Ÿä¸€ç®¡ç†
- âœ… **å¯¼å…¥ä¿®å¤**: Serviceå±‚å¼•ç”¨è·¯å¾„å·²æ›´æ–°
- âœ… **æ–‡æ¡£æ›´æ–°**: Swaggerè¯´æ˜å·²æ›´æ–°
- âœ… **ç¼–è¯‘æˆåŠŸ**: é¡¹ç›®å¯ä»¥æ­£å¸¸ç¼–è¯‘è¿è¡Œ

ç°åœ¨æ‚¨çš„é¡¹ç›®çœŸæ­£å®ç°äº†åŸºäºAOPçš„åŠ¨æ€æ•°æ®æºåˆ‡æ¢ï¼Œmapperå±‚å®Œå…¨è§£è€¦ï¼Œå¯ä»¥çµæ´»ä½¿ç”¨ä»»æ„æ•°æ®æºè®¿é—®ä»»æ„è¡¨ï¼ğŸš€